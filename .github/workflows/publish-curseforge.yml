name: Publish to CurseForge

on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Get release info
        id: release
        uses: actions/github-script@v6
        with:
          script: |
            const release = context.payload.release;
            return {
              tag: release.tag_name,
              name: release.name,
              body: release.body
            };
      
      - name: Download release asset
        run: |
          ASSET_URL=$(curl -s https://api.github.com/repos/${{ github.repository }}/releases/tags/${{ fromJson(steps.release.outputs.result).tag }} | jq -r '.assets[] | select(.name == "decorations-plus.zip") | .browser_download_url')
          curl -L -o decorations-plus.zip "$ASSET_URL"
      
      - name: Upload to CurseForge
        uses: itsmeow/curseforge-upload@v3
        with:
          token: ${{ secrets.CURSEFORGE_TOKEN }}
          project_id: 1079709
          game_endpoint: minecraft
          file_path: decorations-plus.zip
          changelog: ${{ fromJson(steps.release.outputs.result).body }}
          changelog_type: markdown
          game_versions: "1.20.1"
          release_type: release